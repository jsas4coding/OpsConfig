# v2.0.0 (2025-12-26)

Major security hardening release based on comprehensive audit by 3 parallel security agents analyzing bash configs, nvim configs, and install scripts.

## Added

### Standalone Update Script (`./update`)

New dedicated update script extracted from `.bash_custom` with powerful features:

- **Server cleanup** - Cleans logs, APT cache, old kernels, npm/pip/composer/go caches, nvim temp files, and trash
- **Hook authorization** - Prompts for permission before executing `before_install` and `after_install` hooks
- **Flexible options**:
  - `--cleanup-only` - Only run server cleanup without updating
  - `--no-cleanup` - Update without cleanup
  - `--help` - Show usage

```bash
# Full update with cleanup
u

# Only cleanup server
uc

# Update without cleanup
u --no-cleanup
```

### HISTIGNORE Security

New bash history filtering to prevent sensitive data from being saved:

- Passwords, secrets, tokens, API keys, credentials
- Export commands with KEY, SECRET, TOKEN, PASS, AUTH
- Database commands with passwords (`mysql -p`, `psql -W`, `mongo --password`)
- HTTP auth (`curl -u`, `wget --password`)
- Cloud credentials (AWS_*, GCP_*, AZURE_*)
- SSH keys (`ssh-add`, `id_rsa`, `id_ed25519`)

## Changed

### Simplified Bash Configuration

- **Ubuntu-only** - Removed multi-distro detection since target is always Ubuntu servers
- **Delegated updates** - `update_system()` now calls standalone `./update` script
- **New alias** - `uc` for cleanup-only mode

### fnm Installation Method

Replaced unsafe `curl | bash` with direct binary download from GitHub releases:

```bash
# Before (unsafe)
curl -fsSL https://fnm.vercel.app/install | bash

# After (safe)
curl -fsSL "https://github.com/Schniz/fnm/releases/latest/download/fnm-linux.zip" -o "/tmp/fnm-linux.zip"
unzip -o "/tmp/fnm-linux.zip" -d "${fnm_dir}"
```

## Security

### Command Injection Prevention

Replaced dangerous `eval` with safe `printf -v` in all install scripts:

```bash
# Before (vulnerable to injection)
eval "${var_name}=\"${result}\""

# After (safe)
printf -v "${var_name}" '%s' "${result}"
```

**Files fixed:**
- `install` - `ask_config()`, `ask_yes_no()`
- `install-php` - `ask_input()`, `ask_yes_no()`, `ask_menu()`

### Remote Code Execution Prevention

Eliminated all `curl | bash` patterns:

| Location | Before | After |
|----------|--------|-------|
| SpaceVim uninstall | `curl \| bash` | Direct `rm -rf` |
| fnm install | `curl \| bash` | Direct binary download |
| fnm in upgrade-node-manager | `curl \| bash` | Direct binary download |

### Unsafe Neovim Keymaps Removed

Removed keymaps that could execute arbitrary code:

- `<leader>lx` - Executed current line/selection as Lua code
- `<leader>rl` - Sourced any file without path validation

### LSP Debug Logging Disabled

Removed `vim.lsp.set_log_level('debug')` which could:
- Leak sensitive information from edited files
- Impact performance
- Fill disk with large log files

## Migration Notes

### Breaking Changes

None. All changes are backwards compatible.

### New Aliases

| Alias | Command | Description |
|-------|---------|-------------|
| `u` | `update_system` | Full update (unchanged) |
| `uc` | `update_system --cleanup-only` | Server cleanup only |

### Hook Authorization

If you have `before_install` or `after_install` hooks, you'll now be prompted:

```
[WARN] Hooks found: before_install after_install
Authorize hook execution? [y/N]:
```

This adds a security layer without breaking existing workflows.
